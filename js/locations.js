const locationData = {
    "locations": [
        {
            "name": "Catamarca Province",
            "country": "Argentina",
            "type": "Rally",
            "track_surface": ["Heavy Gravel"],
            "stages": {
                "direction": {
                    "forward": [
                        {
                            "name": "Las Juntas",
                            "distance": 8.25
                        },
                        {
                            "name": "Valle de los puentes",
                            "distance": 7.98
                        },
                        {
                            "name": "Camino de acantilados y rocas",
                            "distance": 5.30
                        },
                        {
                            "name": "San Isidro",
                            "distance": 4.48
                        },
                        {
                            "name": "Miraflores",
                            "distance": 3.35
                        },
                        {
                            "name": "El Rodeo",
                            "distance": 2.84
                        }
                    ],
                    "reverse": [
                        {
                            "name": "Camino a La Puerta",
                            "distance": 8.25
                        },
                        {
                            "name": "Valle de los puentes a la inversa",
                            "distance": 7.98
                        },
                        {
                            "name": "Camino de acantilados y rocas inverso",
                            "distance": 5.30
                        },
                        {
                            "name": "Camino a Coneta",
                            "distance": 4.48
                        },
                        {
                            "name": "Huillaprima",
                            "distance": 3.35
                        },
                        {
                            "name": "La Merced",
                            "distance": 2.84
                        }
                    ]
                }
            }
        },
        {
            "name": "Monaro",
            "country": "Australia",
            "type": "Rally",
            "track_surface": ["Gravel", "Smooth Asphalt", "Medium Gravel"],
            "stages" : {
                "direction": {
                    "forward": [
                        {
                            "name": "Mount Kaye Pass",
                            "distance": 12.50
                        },
                        {
                            "name": "Chandlers Creek",
                            "distance": 12.34
                        },
                        {
                            "name": "Bondi Forest",
                            "distance": 7.01
                        },
                        {
                            "name": "Rockton Plains",
                            "distance": 6.89
                        },
                        {
                            "name": "Yambulla Mountain Ascent",
                            "distance": 6.64
                        },
                        {
                            "name": "Noorinbee Ridge Ascent",
                            "distance": 5.28
                        }
                    ],
                    "reverse": [
                        {
                            "name": "Mount Kaye Pass Reverse",
                            "distance": 12.50
                        },
                        {
                            "name": "Chandlers Creek Reverse",
                            "distance": 12.34
                        },
                        {
                            "name": "Taylor Farm Sprint",
                            "distance": 7.01
                        },
                        {
                            "name": "Rockton Plains Reverse",
                            "distance": 6.89
                        },
                        {
                            "name": "Yambulla Mountain Descent",
                            "distance": 6.64
                        },
                        {
                            "name": "Noorinbee Ridge Descent",
                            "distance": 5.28
                        }
                    ]
                }
            }
        },
        {
            "name": "Jämsä",
            "country": "Finland",
            "type": "Rally",
            "track_surface": ["Light Gravel"],
            "stages" : {
                "direction": {
                    "forward": [
                        {
                            "name": "Kakaristo",
                            "distance": 16.20
                        },
                        {
                            "name": "Kontinjärvi",
                            "distance": 15.05
                        },
                        {
                            "name": "Kotajärvi",
                            "distance": 8.10
                        },
                        {
                            "name": "Iso Oksjärvi",
                            "distance": 8.04
                        },
                        {
                            "name": "Kailajärvi",
                            "distance": 7.51
                        },
                        {
                            "name": "Naarajärvi",
                            "distance": 7.43
                        }
                    ],
                    "reverse": [
                        {
                            "name": "Pitkäjärvi",
                            "distance": 16.20
                        },
                        {
                            "name": "Hämelahti",
                            "distance": 14.96
                        },
                        {
                            "name": "Oksala",
                            "distance": 8.10
                        },
                        {
                            "name": "Järvenkylä",
                            "distance": 8.05
                        },
                        {
                            "name": "Jyrkysjärvi",
                            "distance": 7.55
                        },
                        {
                            "name": "Paskuri",
                            "distance": 7.34
                        }
                    ]
                }       
            }
        },
        {
            "name": "Baumholder",
            "country": "Germany",
            "type": "Rally",
            "track_surface": ["Smooth Asphalt", "Concrete", "Cobblestone"],
            "stages" : {
                "direction": {
                    "forward": [
                        {
                            "name": "Oberstein",
                            "distance": 11.67
                        },
                        {
                            "name": "Hammerstein",
                            "distance": 10.81
                        },
                        {
                            "name": "Kreuzungsring",
                            "distance": 6.31
                        },
                        {
                            "name": "Verbundsring",
                            "distance": 5.85
                        },
                        {
                            "name": "Innerer Feld-Sprint",
                            "distance": 5.56
                        },
                        {
                            "name": "Waldaufstieg",
                            "distance": 5.39
                        }
                    ],
                    "reverse": [
                        {
                            "name": "Frauenberg",
                            "distance": 11.67
                        },
                        {
                            "name": "Ruschberg",
                            "distance": 10.70
                        },
                        {
                            "name": "Kreuzungsring reverse",
                            "distance": 6.31
                        },
                        {
                            "name": "Verbundsring Reverse",
                            "distance": 5.85
                        },
                        {
                            "name": "Innerer Feld-Sprint (umgekehrt)",
                            "distance": 5.56
                        },
                        {
                            "name": "Waldabstieg",
                            "distance": 5.39
                        }
                    ]
                }
            }
        },
        {
            "name": "Argolis",
            "country": "Greece",
            "type": "Rally",
            "track_surface": ["Medium Gravel", "Gravel", "Heavy Gravel"],
            "stages" : {
                "direction": {
                    "forward": [
                        {
                            "name": "Anodou Farmakas",
                            "distance": 9.60
                        },
                        {
                            "name": "Pomona Érixi",
                            "distance": 5.09
                        },
                        {
                            "name": "Koryfi Dafni",
                            "distance": 4.50
                        },
                        {
                            "name": "Perasma Platani",
                            "distance": 10.69
                        },
                        {
                            "name": "Ourea Spevsi",
                            "distance": 5.74
                        },
                        {
                            "name": "Abies Koiláda",
                            "distance": 7.09
                        }
                    ],
                    "reverse": [
                        {
                            "name": "Kathodo Leontiou",
                            "distance": 9.60
                        },
                        {
                            "name": "Fourkéta Kourva",
                            "distance": 4.50
                        },
                        {
                            "name": "Ampelonas Ormi",
                            "distance": 4.95
                        },
                        {
                            "name": "Tsiristra Théa",
                            "distance": 10.36
                        },
                        {
                            "name": "Pedines Epidaxi",
                            "distance": 5.38
                        },
                        {
                            "name": "Ypsona tou Dasos",
                            "distance": 6.59
                        }
                    ]
                }
            }
        },
        {
            "name": "Monte Carlo",
            "country": "Monaco",
            "type": "Rally",
            "track_surface": ["Smooth Asphalt", "Ice", "Snow"],
            "stages" : {
                "direction": {
                    "forward": [
                        {
                            "name": "Vallée descendante",
                            "distance": 10.87
                        },
                        {
                            "name": "Pra d’Alart",
                            "distance": 9.83
                        },
                        {
                            "name": "Col de Turini - Départ en descente",
                            "distance": 6.85
                        },
                        {
                            "name": "Gordolon - Courte montée",
                            "distance": 5.17
                        },
                        {
                            "name": "Col de Turini sprint en montée",
                            "distance": 4.73
                        },
                        {
                            "name": "Route de Turini Descente",
                            "distance": 3.95
                        }
                    ],
                    "reverse": [
                        {
                            "name": "Route de Turini",
                            "distance": 10.87
                        },
                        {
                            "name": "Col de Turini Départ",
                            "distance": 9.83
                        },
                        {
                            "name": "Route de Turini Montée",
                            "distance": 6.84
                        },
                        {
                            "name": "Col de Turini - Descente",
                            "distance": 5.17
                        },
                        {
                            "name": "Col de Turini sprint en descente",
                            "distance": 4.73
                        },
                        {
                            "name": "Pra d’Alart Descente",
                            "distance": 3.95
                        }
                    ]
                }
            }
        },
        {
            "name": "Hawkes Bay",
            "country": "New Zealand",
            "type": "Rally",
            "track_surface": ["Gravel"],
            "stages" : {
                "direction": {
                    "forward": [
                        {
                            "name": "Waimarama Point Forward",
                            "distance": 16.06
                        },
                        {
                            "name": "Te Awanga Forward",
                            "distance": 11.48
                        },
                        {
                            "name": "Waimarama Sprint Forward",
                            "distance": 8.81
                        },
                        {
                            "name": "Elsthorpe Sprint Forward",
                            "distance": 7.32
                        },
                        {
                            "name": "Ocean Beach Sprint Forward",
                            "distance": 6.61
                        },
                        {
                            "name": "Te Awanga Sprint Forward",
                            "distance": 4.79
                        }
                    ],
                    "reverse": [
                        {
                            "name": "Waimarama Point Reverse",
                            "distance": 16.06
                        },
                        {
                            "name": "Ocean Beach",
                            "distance": 11.48
                        },
                        {
                            "name": "Waimarama Sprint Reverse",
                            "distance": 8.81
                        },
                        {
                            "name": "Elsthorpe Sprint Reverse",
                            "distance": 7.32
                        },
                        {
                            "name": "Ocean Beach Sprint Reverse",
                            "distance": 6.61
                        },
                        {
                            "name": "Te Awanga Sprint Reverse",
                            "distance": 4.79
                        }
                    ]
                }
            }
            
        },
        {
            "name": "Łęczna County",
            "country": "Poland",
            "type": "Rally",
            "track_surface": ["Smooth Asphalt", "Dirt"],
            "stages" : {
                "direction": {
                    "forward": [
                        {
                            "name": "Zaróbka",
                            "distance": 16.46
                        },
                        {
                            "name": "Zienki",
                            "distance": 13.42
                        },
                        {
                            "name": "Marynka",
                            "distance": 9.25
                        },
                        {
                            "name": "Kopina",
                            "distance": 7.03
                        },
                        {
                            "name": "Lejno",
                            "distance": 6.72
                        },
                        {
                            "name": "Czarny Las",
                            "distance": 6.62
                        }
                    ],
                    "reverse": [
                        {
                            "name": "Zagórze",
                            "distance": 16.46
                        },
                        {
                            "name": "Jezioro Rotcze",
                            "distance": 13.42
                        },
                        {
                            "name": "Borysik",
                            "distance": 9.25
                        },
                        {
                            "name": "Józefin",
                            "distance": 7.03
                        },
                        {
                            "name": "Jagodno",
                            "distance": 6.82
                        },
                        {
                            "name": "Jezioro Lukie",
                            "distance": 6.62
                        }
                    ]
                }
            }
        },
        {
            "name": "Ribadelles",
            "country": "Spain",
            "type": "Rally",
            "track_surface": ["Smooth Asphalt"],
            "stages" : {
                "direction": {
                    "forward": [
                        {
                            "name": "Comienzo De Bellriu",
                            "distance": 14.34
                        },
                        {
                            "name": "Centenera",
                            "distance": 10.57
                        },
                        {
                            "name": "Ascenso por valle el Gualet",
                            "distance": 7.00
                        },
                        {
                            "name": "Viñedos dentro del valle Parra",
                            "distance": 6.81
                        },
                        {
                            "name": "Viñedos Dardenyà",
                            "distance": 6.55
                        },
                        {
                            "name": "Descenso por carretera",
                            "distance": 4.58
                        }
                    ],
                    "reverse": [
                        {
                            "name": "Final de Bellriu",
                            "distance": 14.34
                        },
                        {
                            "name": "Camino a Centenera",
                            "distance": 10.57
                        },
                        {
                            "name": "Salida desde Montverd",
                            "distance": 7.00
                        },
                        {
                            "name": "Ascenso bosque Montverd",
                            "distance": 6.81
                        },
                        {
                            "name": "Viñedos Dardenyà inversa",
                            "distance": 6.55
                        },
                        {
                            "name": "Subida por carretera",
                            "distance": 4.58
                        }
                    ]
                }
            }
        },
        {
            "name": "Värmland",
            "country": "Sweden",
            "type": "Rally",
            "track_surface": ["Slush", "Compacted Snow", "Snow"],
            "stages" : {
                "direction": {
                    "forward": [
                        {
                            "name": "Hamra",
                            "distance": 12.34
                        },
                        {
                            "name": "Ransbysäter",
                            "distance": 11.98
                        },
                        {
                            "name": "Elgsjön",
                            "distance": 7.28
                        },
                        {
                            "name": "Stor-jängen Sprint",
                            "distance": 6.69
                        },
                        {
                            "name": "Älgsjön Sprint",
                            "distance": 5.25
                        },
                        {
                            "name": "Östra Hinnsjön",
                            "distance": 5.19
                        }
                    ],
                    "reverse": [
                        {
                            "name": "Lysvik",
                            "distance": 12.34
                        },
                        {
                            "name": "Norraskoga",
                            "distance": 11.98
                        },
                        {
                            "name": "Älgsjön",
                            "distance": 7.28
                        },
                        {
                            "name": "Stor-jängen Sprint Reverse",
                            "distance": 6.69
                        },
                        {
                            "name": "Skogsrallyt",
                            "distance": 5.25
                        },
                        {
                            "name": "Björklangen",
                            "distance": 5.19
                        }
                    ]
                }
            }
        },
        {
            "name": "New England",
            "country": "USA",
            "type": "Rally",
            "track_surface": ["Medium Gravel", "Heavy Gravel"],
            "stages" : {
                "direction": {
                    "forward": [
                        {
                            "name": "Beaver Creek Trail Forward",
                            "distance": 12.86
                        },
                        {
                            "name": "North Fork Pass",
                            "distance": 12.50
                        },
                        {
                            "name": "Hancock Creek Burst",
                            "distance": 6.89
                        },
                        {
                            "name": "Fuller Mountain Ascent",
                            "distance": 6.64
                        },
                        {
                            "name": "Tolt Valley Sprint Forward",
                            "distance": 6.10
                        },
                        {
                            "name": "Hancock Hill Sprint Forward",
                            "distance": 6.01
                        }
                    ],
                    "reverse": [
                        {
                            "name": "Beaver Creek Trail Reverse",
                            "distance": 12.86
                        },
                        {
                            "name": "North Fork Pass Reverse",
                            "distance": 12.50
                        },
                        {
                            "name": "Fury Lake Depart",
                            "distance": 6.89
                        },
                        {
                            "name": "Fuller Mountain Descent",
                            "distance": 6.64
                        },
                        {
                            "name": "Tolt Valley Sprint Reverse",
                            "distance": 6.10
                        },
                        {
                            "name": "Hancock Hill Sprint Reverse",
                            "distance": 6.01
                        }
                    ]
                }
            }
        },
        {
            "name": "Powys",
            "country": "Wales",
            "type": "Rally",
            "track_surface": ["Medium Gravel"],
            "stages" : {
                "direction": {
                    "forward": [
                        {
                            "name": "River Severn Valley",
                            "distance": 11.40
                        },
                        {
                            "name": "Sweet Lamb",
                            "distance": 9.90
                        },
                        {
                            "name": "Fferm Wynt",
                            "distance": 5.70
                        },
                        {
                            "name": "Dyffryn Afon",
                            "distance": 5.70
                        },
                        {
                            "name": "Bidno Moorland",
                            "distance": 4.90
                        },
                        {
                            "name": "Pant Mawr",
                            "distance": 4.70
                        }
                    ],
                    "reverse": [
                        {
                            "name": "Bronfelen",
                            "distance": 11.40
                        },
                        {
                            "name": "Geufron Forest",
                            "distance": 10.00
                        },
                        {
                            "name": "Fferm Wynt Reverse",
                            "distance": 5.70
                        },
                        {
                            "name": "Dyffryn Afon Reverse",
                            "distance": 5.70
                        },
                        {
                            "name": "Bidno Moorland Reverse",
                            "distance": 4.80
                        },
                        {
                            "name": "Pant Mawr Reverse",
                            "distance": 5.10
                        }
                    ]
                }
            }
        },
        {
            "name": "Perth and Kinross",
            "country": "Scotland",
            "type": "Rally",
            "track_surface": ["Medium Gravel"],
            "stages" : {
                "direction": {
                    "forward": [
                        {
                            "name": "Newhouse Bridge",
                            "distance": 12.86
                        },
                        {
                            "name": "South Morningside",
                            "distance": 12.58
                        },
                        {
                            "name": "Annbank Station",
                            "distance": 7.77
                        },
                        {
                            "name": "Rosebank Farm",
                            "distance": 7.16
                        },
                        {
                            "name": "Old Butterstone Muir",
                            "distance": 5.82
                        },
                        {
                            "name": "Glencastle Farm",
                            "distance": 5.25
                        }
                    ],
                    "reverse": [
                        {
                            "name": "Newhouse Bridge Reverse",
                            "distance": 12.98
                        },
                        {
                            "name": "South Morningside Reverse",
                            "distance": 12.66
                        },
                        {
                            "name": "Annbank Station Reverse",
                            "distance": 7.59
                        },
                        {
                            "name": "Rosebank Farm Reverse",
                            "distance": 6.96
                        },
                        {
                            "name": "Old Butterstone Muir Reverse",
                            "distance": 5.66
                        },
                        {
                            "name": "Glencastle Farm Reverse",
                            "distance": 5.24
                        }
                    ]
                }
            }
        },
        {
            "name": "Mettet",
            "country": "Belgium",
            "type": "Rallycross",
            "track_surface": ["Smooth Asphalt", "Dirt"]
        },
        {
            "name": "Trois-Rivières",
            "country": "Canada",
            "type": "Rallycross",
            "track_surface": ["Smooth Asphalt", "Gravel"]
        },
        {
            "name": "Lydden Hill",
            "country": "England",
            "type": "Rallycross",
            "track_surface": ["Asphalt", "Concrete", "Dirt"]
        },
        {
            "name": "Silverstone",
            "country": "England",
            "type": "Rallycross",
            "track_surface": ["Dirt", "Smooth Asphalt"]
        },
        {
            "name": "Lohéac Bretagne",
            "country": "France",
            "type": "Rallycross",
            "track_surface": ["Rough Asphalt", "Smooth Asphalt", "Dirt"]
        },
        {
            "name": "Estering",
            "country": "Germany",
            "type": "Rallycross",
            "track_surface": ["Rough Asphalt", "Dirt"]
        },
        {
            "name": "Bikernieki",
            "country": "Latvia",
            "type": "Rallycross",
            "track_surface": ["Rough Asphalt", "Gravel"]
        },
        {
            "name": "Hell",
            "country": "Norway",
            "type": "Rallycross",
            "track_surface": ["Asphalt", "Dirt", "Gravel"]
        },
        {
            "name": "Montalegre",
            "country": "Portugal",
            "type": "Rallycross",
            "track_surface": ["Asphalt", "Dirt"]
        },
        {
            "name": "Killarney International Raceway",
            "country": "South Africa",
            "type": "Rallycross",
            "track_surface": ["Smooth Asphalt", "Light Gravel"]
        },
        {
            "name": "Circuit de Barcelona-Catalunya",
            "country": "Spain",
            "type": "Rallycross",
            "track_surface": ["Asphalt", "Dirt"]
        },
        {
            "name": "Höljes",
            "country": "Sweden",
            "type": "Rallycross",
            "track_surface": ["Asphalt", "Dirt", "Gravel"]
        },
        {
            "name": "Yas Marina Circuit",
            "country": "Abu Dhabi",
            "type": "Rallycross",
            "track_surface": ["Light Gravel", "Smooth Asphalt"]
        }
    ]
};

const locations = locationData.locations;
const locationContainer = document.getElementById("locationContainer");

const events = [];
const countries = [];
const surfaces = [];

const eventsContent = document.getElementById("event-dropdown-content");
const countriesContent = document.getElementById("country-dropdown-content");
const surfacesContent = document.getElementById("surface-dropdown-content");

function findLocationKeyData() {
    locations.forEach((location) => {
        if (!events.includes(location.type)) {
            events.push(location.type);
        }
        if (!countries.includes(location.country)) {
            countries.push(location.country);
        }
        location.track_surface.forEach((surface) => {
            if (!surfaces.includes(surface)) {
                surfaces.push(surface)
            }
        });
    });
}

function convertLocation() {
    locations.forEach((location) => {
        let id = location.name
        id = id.replace(/ /g, "-").toLowerCase();
        let img = location.name + "-" + location.country
        img = img.replace(/ /g, "-").toLowerCase();
        let surfaceList = [];
        let stageForward = [];
        let stageReverse = [];
    
        if (location.stages) {
            let forward = location.stages.direction.forward;
            let reverse = location.stages.direction.reverse;
    
            forward.forEach((stage) => {
                stageForward.push( 
                    `<li class="stage">
                        <p class="stage-name">${ stage.name }</p>
                        <p class="stage-distance">${ stage.distance }</p>
                    </li>`
                );
            });
    
            reverse.forEach((stage) => {
                stageReverse.push( 
                    `<li class="stage">
                        <p class="stage-name">${ stage.name }</p>
                        <p class="stage-distance">${ stage.distance }</p>
                    </li>`
                );
            });
        }
    
        let surfaces = [];
        location.track_surface.forEach((surface) => {
            surfaceList.push(
                `<li class="surface">
                    <p>${ surface }</p>
                </li>`
            );
            surfaces.push(surface);
        });
        surfaces = surfaces.toString().replace(/,/g, " | ")

        locationContainer.insertAdjacentHTML(
            "beforeend",
            `<ul id="${ id }" class="tile location-tile">
                <li>
                    <img src="images/locations/${ img }.jpg" alt="${ location.name } ${ location.country } image" class="tile-img location-img">
                    <h1 class="tile-name location-name">${ location.name } |</h1>
                    <h2 class="tile-name location-country">${ location.country }</h2>
                    <button id="${ id }-details-btn" class="btn-details btn-primary">Details</button>
                </li>
            </ul>
            <aside id="${ id }-modal" class="modal location-modal hide">
                <ul>
                    <li>
                        <img src="images/locations/${ img }.jpg" alt="${ location.name } ${ location.country } image" class="modal-img">
                        <h2 class="location-modal-name">${ location.name } |</h2>
                        <h3 class="location-modal-name">${ location.country }</h3>
                        <p class="location-surface">${ surfaces }</p>
                        <button id="${ id }-close" class="btn-red-xmark fa-solid fa-xmark"></button>
                    </li>
                </ul>
            </aside>`
        );
        let locationTile = document.getElementById(id + "-modal");
        if (locationTile && location.stages) {
            locationTile.insertAdjacentHTML(
                "beforeend",
                `<ul class="stages">
                    <li>
                        <ul class="stages-forward-list">
                            <li>
                                <h2 class="stages-direction">Forward</h2>
                            </li>
                            ${ stageForward.toString().replace(/,/g, "") }
                        </ul>
                    </li>
                    <li>
                        <ul class="stages-reverse-list">
                            <h2 class="stages-direction">Reverse</h2>
                            ${ stageReverse.toString().replace(/,/g, "") }
                        </ul>
                    </li>
                </ul>`
            );
        }
    });
}

function locationFilters() {
    events.forEach((type) => {
        eventsContent.insertAdjacentHTML("beforeend",
            `<li>
                <input type="checkbox" name="event" class="dropdown-item" value="${ type }">${ type }</input>
            </li>`
        );
    });
    
    countries.forEach((country) => {
        countriesContent.insertAdjacentHTML("beforeend",
            `<li>
                <input type="checkbox" name="country" class="dropdown-item" value="${ country }">${ country }</input>
            </li>`
        );
    });
    
    surfaces.forEach((surface) => {
        surfacesContent.insertAdjacentHTML("beforeend",
            `<li>
                <input type="checkbox" name="surface" class="dropdown-item" value="${ surface }">${ surface }</input>
            </li>`
        );
    });
}

findLocationKeyData();
convertLocation();
locationFilters();